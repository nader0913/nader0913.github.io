<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <!-- Markdown parser (GitHub-Flavored) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Polyfill for MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <!-- MathJax for LaTeX support -->
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="UTF-8">
  <title>nader0913</title>
  <style>
    body {
      font-family: Georgia, 'Times New Roman', serif;
      width: 750px;
      max-width: 750px;
      min-width: 750px;
      margin: 0 auto;
      padding: 1em 2em;
      height: 100%;
      display: flex;
      flex-direction: column;
      line-height: 1.45;
      color: #222;
      font-size: 16px;
      box-sizing: border-box;
    }

    html {
      height: 100%;
      display: flex;
      flex-direction: column;
      -webkit-text-size-adjust: 100%;
      -moz-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    #main-page,
    #projects-list {
      display: block;
      width: 100%;
      margin-top: 2em;
      padding: 0;
      box-sizing: border-box;
    }

    #main-footer {
      text-align: center;
      font-size: 0.8em;
      color: #666;
      padding: 2em 0 0.8em;
      margin-top: auto;
      line-height: 1.45;
    }

    #main-title {
      text-align: center;
      margin-bottom: 1.5em;
    }

    #main-title h1 {
      font-size: 1.6em;
      margin-bottom: 0.5em;
      color: #000;
      font-weight: bold;
      line-height: 1.1;
      text-transform: none;
      letter-spacing: 0;
      border-bottom: none;
    }

    #main-nav {
      display: flex;
      justify-content: center;
      gap: 2em;
      margin-bottom: 1.5em;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.8em;
    }

    .nav-item {
      font-size: 1em;
      color: #333;
      text-decoration: none;
      font-weight: normal;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0.3em 0;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .nav-item:hover,
    .nav-item.active {
      color: #000;
      border-bottom-color: #000;
    }

    .page-content {
      display: none;
      width: 100%;
      box-sizing: border-box;
    }

    .page-content.active {
      display: block;
    }


    .cv-content {
      width: 100%;
      margin: 0;
      box-sizing: border-box;
      line-height: 1.4;
    }

    .cv-intro {
      margin-bottom: 2em;
      text-align: left;
    }

    .cv-intro p {
      font-size: 1em;
      color: #444;
      line-height: 1.5;
      margin: 0;
    }

    .cv-timeline {
      position: relative;
      margin-bottom: 1.5em;
    }

    .cv-timeline::before {
      content: '';
      position: absolute;
      left: 50px;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: #ddd;
    }

    .cv-item {
      display: flex;
      margin-bottom: 1.2em;
      position: relative;
    }

    .cv-item::before {
      content: '';
      position: absolute;
      left: 48px;
      top: 0.3em;
      width: 6px;
      height: 6px;
      background-color: #333;
      border-radius: 50%;
      z-index: 1;
    }

    .cv-year {
      width: 40px;
      font-weight: bold;
      font-size: 0.9em;
      color: #333;
      text-align: right;
      padding-right: 0;
      flex-shrink: 0;
    }

    .cv-details {
      flex: 1;
      padding-left: 1.5em;
    }

    .cv-role {
      font-weight: bold;
      font-size: 1em;
      color: #000;
      margin-bottom: 0.2em;
    }

    .cv-location {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 0.3em;
    }

    .cv-desc {
      font-size: 0.9em;
      color: #444;
      line-height: 1.3;
      margin: 0;
      padding-left: 1em;
    }

    .cv-desc li {
      margin: 0.2em 0;
      line-height: 1.4;
    }



    .post-title {
      display: block;
      font-size: 1em;
      text-decoration: none;
      color: #000;
      margin-bottom: 0.8em;
      line-height: 1.45;
    }

    .post-title:hover {
      text-decoration: underline;
      color: #444;
    }

    #post-content {
      text-align: justify;
      display: none;
      line-height: 1.45;
    }

    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0 0 1em 0;
      padding: 0.8em 0;
      position: relative;
      border-bottom: 1px solid #ddd;
    }

    .nav-links {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 2em 0 0 0;
      padding: 1em 0 0 0;
      position: relative;
      border-top: 1px solid #ddd;
    }

    .back-link {
      color: #444;
      text-decoration: none;
      font-size: 1em;
      line-height: 1.45;
    }

    .article-chapter {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1em;
      font-weight: bold;
      text-align: center;
      line-height: 1.45;
      color: #000;
    }

    .article-title {
      font-size: 2em;
      font-weight: bold;
      text-align: center;
      color: #000;
      line-height: 1.1;
      margin-bottom: 1em;
      letter-spacing: -0.02em;
    }

    .article-divider {
      border: none;
      height: 1px;
      background-color: #333;
      margin: 1.5em 0;
      opacity: 1;
    }

    .article-date {
      font-size: 0.8em;
      color: #666;
      text-align: right;
      font-style: italic;
      margin-bottom: 0.8em;
      line-height: 1.45;
    }

    .nav-links a {
      color: #444;
      text-decoration: none;
      line-height: 1.45;
    }

    a {
      color: #2c5aa0;
      text-decoration: underline;
      transition: color 0.2s ease;
    }

    a:hover {
      color: #1a4480;
    }

    img {
      max-width: 100%;
      display: block;
      margin: 1.2em auto;
      border: 1px solid #ddd;
      padding: 0.2em;
    }

    h1 {
      font-size: 1.5em;
      margin-top: 1.5em;
      margin-bottom: 0.3em;
      border-bottom: 1px solid #333;
      padding-bottom: 0.2em;
      color: #000;
      font-weight: bold;
      line-height: 1.2;
      hyphens: auto;
    }

    h2 {
      font-size: 1em;
      margin-top: 1.2em;
      margin-bottom: 0.3em;
      color: #000;
      font-weight: bold;
      line-height: 1.2;
      hyphens: auto;
      letter-spacing: 0.5px;
    }

    h3 {
      font-size: 1.1em;
      margin-top: 1em;
      margin-bottom: 0.3em;
      font-style: italic;
      color: #000;
      font-weight: bold;
      line-height: 1.2;
      hyphens: auto;
    }

    #markdown-output h1:first-child {
      margin-top: 0;
    }

    #markdown-output {
      margin-top: 0.5em;
    }

    #markdown-output p {
      margin: 0.8em 0 0 0;
      text-align: justify;
      hyphens: none;
    }

    #markdown-output p:first-child,
    #markdown-output p:first-of-type,
    #markdown-output h1+p,
    #markdown-output h2+p,
    #markdown-output h3+p,
    #markdown-output blockquote+p,
    #markdown-output ul+p,
    #markdown-output ol+p,
    #markdown-output .image-block+p,
    #markdown-output .formula-block+p {
      margin-top: 0;
    }

    /* List styling */
    #markdown-output ul,
    #markdown-output ol {
      margin: 1em 0;
      padding-left: 1.8em;
      line-height: 1.45;
    }

    #markdown-output li {
      margin: 0.3em 0;
      line-height: 1.45;
    }

    #markdown-output ul {
      list-style-type: disc;
    }

    #markdown-output ol {
      list-style-type: decimal;
    }

    #markdown-output ul li::marker {
      color: #333;
    }

    #markdown-output ol li::marker {
      color: #333;
      font-weight: bold;
    }

    blockquote {
      background-color: #f9f9f9;
      color: #333;
      padding: 0.8em 1.2em;
      margin: 1.2em 0;
      border-left: 3px solid #ccc;
      border-right: 1px solid #ccc;
      font-style: italic;
      line-height: 1.4;
      border-top: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
    }


    .toc-entry {
      display: block;
      cursor: pointer;
      font-size: 0.95em;
      margin-bottom: 0.4em;
      color: #000;
      text-decoration: none;
      padding: 0.3em 0;
      width: 100%;
      box-sizing: border-box;
      border-bottom: 1px dotted #ccc;
      line-height: 1.3;
    }

    .toc-entry:hover {
      background-color: #f8f8f8;
    }

    .toc-title {
      font-weight: bold;
      margin-bottom: 0.1em;
      display: block;
      line-height: 1.2;
    }

    .toc-meta {
      font-size: 0.8em;
      color: #666;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .toc-chapter {
      font-style: italic;
      font-weight: normal;
    }

    .toc-date {
      font-size: 0.85em;
      color: #666;
      font-weight: normal;
    }

    /* Enhanced Image block style */
    .image-block {
      text-align: center;
      margin: 1.5em 0;
      padding: 0;
    }

    .image-block img {
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 0.5em auto;
      border: 1px solid #ccc;
      padding: 0.3em;
      background-color: #fff;
    }


    .image-caption {
      font-size: 0.75em;
      color: #666;
      margin-top: 0.5em;
      font-style: italic;
      line-height: 1.4;
      text-align: center;
    }

    /* Enhanced Formula block style */
    .formula-block {
      text-align: center;
      margin: 1.5em 0;
      padding: 1em;
      background-color: #f8f8f8;
      border: 1px solid #ccc;
      border-left: 3px solid #ccc;
    }

    .formula-label {
      font-size: 0.75em;
      color: #333;
      margin-bottom: 0.5em;
      font-weight: bold;
      line-height: 1.3;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* MathJax styles */
    .MathJax {
      font-size: 1.1em;
      padding: 0.5em 0;
      line-height: 1.2;
    }

    .math-display {
      display: block;
      margin: 1em 0;
      text-align: center;
      padding: 0.5em;
      border-top: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
    }

    /* Center math formulas */
    .MathJax_Display {
      text-align: center;
      margin: 0.8em 0;
    }

    /* support GFM tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.2em 0;
      border: 1px solid #ccc;
      font-size: 0.9em;
    }

    th {
      background-color: #f8f8f8;
      border-bottom: 1px solid #ccc;
      border-right: 1px solid #ccc;
      padding: 0.6em 0.8em;
      text-align: left;
      line-height: 1.3;
      font-weight: bold;
      color: #000;
    }

    td {
      border-bottom: 1px solid #ccc;
      border-right: 1px solid #ccc;
      padding: 0.5em 0.8em;
      text-align: left;
      line-height: 1.45;
    }

    tr:nth-child(even) td {
      background-color: #fafafa;
    }

    #markdown-output table {
      display: block;
      /* so overflow applies to the table itself */
      max-width: 100%;
      /* never exceed the container width */
      overflow-x: auto;
      /* show a scrollbar only if the content overflows */
    }

    #markdown-output th,
    #markdown-output td {
      white-space: nowrap;
      /* keep each cell on one line, forcing a scroll when it’s too wide */
    }

    /* wrapper scroll styling */
    .table-wrapper {
      position: relative;
      overflow-x: auto;
      max-width: 100%;
    }

    /* fade hint on the right edge */
    .table-wrapper::after {
      content: '';
      pointer-events: none;
      position: absolute;
      top: 0;
      right: 0;
      width: 3rem;
      height: 100%;
      background: linear-gradient(to left, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
    }

    /* optional "⇆ Scroll" label in corner */
    .table-wrapper::before {
      content: '⇆';
      position: absolute;
      right: 0.5rem;
      bottom: 0.3rem;
      font-size: 0.9rem;
      color: #666;
      pointer-events: none;
    }

    /* keep the table itself unchanged */
    .table-wrapper table {
      display: block;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      body {
        width: 100%;
        max-width: 100%;
        min-width: auto;
        margin: 0;
        padding: 1em;
        line-height: 1.45;
        font-size: 16px;
      }

      #main-page {
        width: 100%;
        padding: 0.5em 0;
        margin-top: 1em;
        columns: 1;
        column-rule: none;
        box-sizing: border-box;
      }

      #main-title {
        text-align: center;
      }

      #main-nav {
        gap: 1.5em;
        margin-bottom: 1em;
      }

      .nav-item {
        font-size: 0.9em;
      }

      .toc-entry {
        font-size: 0.85em;
        padding: 0.3em 0;
        margin-bottom: 0.6em;
      }

      .toc-title {
        font-size: 1em;
      }

      .toc-meta {
        font-size: 0.75em;
      }

      .article-title {
        font-size: 1.8em;
        margin-bottom: 0.8em;
      }

      h1 {
        font-size: 1.3em;
        margin-top: 1.2em;
      }

      h2 {
        font-size: 1.15em;
        margin-top: 1em;
      }

      h3 {
        font-size: 1.05em;
        margin-top: 0.8em;
      }

      .nav-links {
        margin: 1.5em 0 0 0;
        padding: 0.8em 0 0 0;
      }

      .top-nav {
        margin: 0 0 0.8em 0;
        padding: 0.6em 0;
      }
    }
  </style>
</head>

<body>
  <div id="main-title">
    <h1>nader0913</h1>
  </div>

  <nav id="main-nav">
    <a href="#blog" class="nav-item active" onclick="return showPage('blog', this)">Blog</a>
    <a href="#projects" class="nav-item" onclick="return showPage('projects', this)">Projects</a>
    <a href="#about" class="nav-item" onclick="return showPage('about', this)">About</a>
  </nav>

  <div id="blog-page" class="page-content active">
    <div id="main-page">
    </div>
  </div>

  <div id="projects-page" class="page-content">
    <div id="projects-list">
    </div>
  </div>

  <div id="about-page" class="page-content">
    <div class="cv-content">
      <div class="cv-intro">
        <p>Software engineer with experience in high-performance systems and cryptographic solutions. Focused on
          building secure, scalable applications across diverse technology environments.</p>
      </div>

      <div class="cv-timeline">
        <div class="cv-item">
          <div class="cv-year">2025</div>
          <div class="cv-details">
            <div class="cv-role">Junior Software Engineer @ Alpitronic</div>
            <div class="cv-location">Munich, Germany</div>
            <ul class="cv-desc">
              <li>Working on OCPP 2.0.1 Certification in C++</li>
            </ul>
          </div>
        </div>

        <div class="cv-item">
          <div class="cv-year">2024</div>
          <div class="cv-details">
            <div class="cv-role">Software Engineer Intern @ EcoG</div>
            <div class="cv-location">Munich, Germany • Mar-Sep</div>
            <ul class="cv-desc">
              <li>Developed high throughput solutions for SECC to module communication, including OCMF Meters
                integration</li>
              <li>Contributed to OCPP 2.0 Certification process under OCTT framework</li>
            </ul>
          </div>
        </div>

        <div class="cv-item">
          <div class="cv-year">2023</div>
          <div class="cv-details">
            <div class="cv-role">Software Engineer Intern @ Arcium</div>
            <div class="cv-location">Switzerland • Jun-Dec</div>
            <ul class="cv-desc">
              <li>Developed MVP integrating SPDZ-based multi-party computation for secure key generation and transaction
                screening</li>
              <li>Implemented cryptographic solutions using Zero Knowledge Proofs and Homomorphic Encryption</li>
              <li>Authored technical blogs on elliptic curves and homomorphic encryption</li>
            </ul>
          </div>
        </div>

        <div class="cv-item">
          <div class="cv-year">2022</div>
          <div class="cv-details">
            <div class="cv-role">Software Engineer Intern @ SAP</div>
            <div class="cv-location">Mougins, France • Jul-Sep</div>
            <ul class="cv-desc">
              <li>Built modular email template generator reducing integration time by 50% and eliminating 7000 lines of
                code</li>
              <li>Implemented i18n solution for multi-language emails, cutting translation costs by 50%</li>
              <li>Enhanced UI, implemented caching, and comprehensive testing</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="post-content">
    <div class="top-nav">
      <a href="#" class="back-link" onclick="goBack()">&larr; Back</a>
      <div class="article-chapter" id="article-chapter"></div>
      <div class="article-date" id="article-date"></div>
    </div>
    <div class="article-title" id="article-title"></div>
    <div id="markdown-output"></div>
    <div class="nav-links">
      <a href="#" onclick="prevPost()">&larr; Previous</a>
      <a href="#" onclick="nextPost()">Next &rarr;</a>
    </div>
  </div>

  <script>
    const posts = [
      { file: 'pareto-distribution.md', title: 'Pareto Distribution and Wealth Disparity', slug: 'pareto-distribution', tags: ['Distributions'], date: 'Jul 23, 2021' },
      { file: 'baader-meinhof-phenomenon.md', title: 'Baader Meinhof Phenomenon', slug: 'baader-meinhof-phenomenon', tags: ['Phenomenons'], date: '10 Dec, 2023' },
      { file: 'goldilocks-rule-and-flow-state.md', title: 'Goldilocks Rule and Flow State', slug: 'goldilocks-rule-and-flow-state', tags: ['Phenomenons'], date: '24 Nov, 2024' },
      { file: 'homomorphic-encryption.md', title: 'Homomorphic Encryption for Dummies', slug: 'homomorphic-encryption', tags: ['Cryptography'], date: 'Nov 12, 2023' },
      { file: 'shamir-secret-sharing.md', title: 'Shamir Secret Sharing', slug: 'shamir-secret-sharing', tags: ['Cryptography'], date: 'Nov 12, 2023' },
      { file: 'plain-english.md', title: 'How to write in Plain English', slug: 'plain-english', tags: ['Writing'], date: 'Aug 19, 2025' },
    ];

    const projects = [
      { file: 'veilcomm.md', title: 'Veilcomm - Partial Tor Network Implementation in Rust', slug: 'veilcomm', tags: ['Privacy', 'Rust'], date: 'Nov, 2024' }
    ];

    function renderMainPage() {
      const container = document.getElementById('main-page');
      container.innerHTML = '';

      // Sort all posts by date (newest first)
      const sortedPosts = posts
        .slice()
        .sort((a, b) => new Date(b.date) - new Date(a.date));

      sortedPosts.forEach((post, index) => {
        const link = document.createElement('a');
        link.href = `/#/${post.slug}`;
        link.className = 'toc-entry';
        link.target = '_blank';
        link.onclick = (e) => {
          if (e.button === 0 && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
            e.preventDefault();
            loadPost(post.slug);
            return false;
          }
        };


        const titleSpan = document.createElement('span');
        titleSpan.className = 'toc-title';
        titleSpan.textContent = post.title;

        const metaDiv = document.createElement('div');
        metaDiv.className = 'toc-meta';

        const chapterSpan = document.createElement('span');
        chapterSpan.className = 'toc-chapter';
        chapterSpan.textContent = Array.isArray(post.tags) ? post.tags.join(', ') : post.tags;

        const dateSpan = document.createElement('span');
        dateSpan.className = 'toc-date';
        dateSpan.textContent = post.date;

        metaDiv.appendChild(chapterSpan);
        metaDiv.appendChild(dateSpan);

        link.appendChild(titleSpan);
        link.appendChild(metaDiv);
        container.appendChild(link);
      });
    }

    function renderProjectsPage() {
      const container = document.getElementById('projects-list');
      container.innerHTML = '';

      // Sort all projects by date (newest first)
      const sortedProjects = projects
        .slice()
        .sort((a, b) => new Date(b.date) - new Date(a.date));

      sortedProjects.forEach((project, index) => {
        const link = document.createElement('a');
        link.href = `/#/${project.slug}`;
        link.className = 'toc-entry';
        link.target = '_blank';
        link.onclick = (e) => {
          if (e.button === 0 && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
            e.preventDefault();
            loadPost(project.slug);
            return false;
          }
        };

        const titleSpan = document.createElement('span');
        titleSpan.className = 'toc-title';
        titleSpan.textContent = project.title;

        const metaDiv = document.createElement('div');
        metaDiv.className = 'toc-meta';

        const chapterSpan = document.createElement('span');
        chapterSpan.className = 'toc-chapter';
        chapterSpan.textContent = Array.isArray(project.tags) ? project.tags.join(', ') : project.tags;

        const dateSpan = document.createElement('span');
        dateSpan.className = 'toc-date';
        dateSpan.textContent = project.date;

        metaDiv.appendChild(chapterSpan);
        metaDiv.appendChild(dateSpan);

        link.appendChild(titleSpan);
        link.appendChild(metaDiv);
        container.appendChild(link);
      });
    }

    let currentIndex = 0;

    function showPage(pageId, element) {
      // Hide all page contents
      document.querySelectorAll('.page-content').forEach(page => {
        page.style.display = 'none';
        page.classList.remove('active');
      });

      // Remove active from all nav items
      document.querySelectorAll('.nav-item').forEach(nav => {
        nav.classList.remove('active');
      });

      // Show selected page and activate nav item
      const targetPage = document.getElementById(pageId + '-page');
      if (targetPage) {
        targetPage.style.display = 'block';
        targetPage.classList.add('active');
      }

      if (element) {
        element.classList.add('active');
      }

      // Render content for specific pages
      if (pageId === 'projects') {
        renderProjectsPage();
      }

      return false; // prevent default link behavior
    }

    function goBack() {
      document.getElementById('post-content').style.display = 'none';
      document.getElementById('main-title').style.display = 'block';
      document.getElementById('main-nav').style.display = 'flex';
      document.querySelector('.page-content.active').style.display = 'block';
    }

    function prevPost() {
      if (currentIndex > 0) {
        loadPost(posts[currentIndex - 1].slug);
      }
    }

    function nextPost() {
      if (currentIndex < posts.length - 1) {
        loadPost(posts[currentIndex + 1].slug);
      }
    }

    function parseMarkdown(md) {
      // First, escape the escaped dollar signs with a temporary marker
      md = md.replace(/\\\$/g, 'ESCAPED_DOLLAR_SIGN');

      // 1) Split into blocks on blank lines
      const blocks = md.split(/\n{2,}/).map(block => {
        const t = block.trim();

        // 2) Table detection
        if (/^\|.+\n\|[-:| ]+\n?/.test(block)) {
          return renderTable(block);
        }

        // 3) Ordered list detection
        if (/^\s*\d+\.\s+/.test(t)) {
          const items = t
            .split('\n')
            .map(line => {
              const m = line.match(/^\s*\d+\.\s+(.*)$/);
              return m ? `<li>${m[1]}</li>` : '';
            })
            .join('');
          return `<ol>${items}</ol>`;
        }

        // 3b) Unordered list detection
        if (/^\s*-\s+/.test(t)) {
          const items = t
            .split('\n')
            .map(line => {
              const m = line.match(/^\s*-\s+(.*)$/);
              return m ? `<li>${m[1]}</li>` : '';
            })
            .join('');
          return `<ul>${items}</ul>`;
        }

        // 4) Block‐level detection
        const isBlock =
          t.startsWith('> ') ||
          t.startsWith('#') ||
          t.startsWith('<div') ||
          t.startsWith('<blockquote') ||
          t.startsWith('<img') ||
          t.startsWith('$$');

        if (isBlock) return t;

        // 5) Default paragraph
        return `<p>${t}</p>`;
      });

      // 6) Run the pipeline for headings, ULs, styling, etc.
      let html = blocks.join('\n\n')
        // Headings
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        // Bold & italic
        .replace(/\*\*(.*?)\*\*/gim, '<b>$1</b>')
        .replace(/\*(.*?)\*/gim, '<i>$1</i>')
        // Images
        .replace(
          /!\[(.*?)\]\((.*?)\)/gim,
          '<div class="image-block"><img alt="$1" src="$2"><div class="image-caption">$1</div></div>'
        )
        // Links
        .replace(/\[(.*?)\]\((.*?)\)/gim, '<a href="$2" target="_blank">$1</a>')
        // Blockquotes
        .replace(/^>\s?REF:(.*$)/gim, '<div class="quote-secondary">$1</div>')
        .replace(/^>\s?(.*)$/gim, '<blockquote>$1</blockquote>')
        // Display math
        .replace(
          /\$\$(.*?)\$\$/gim,
          '<div class="formula-block"><div class="formula-label">Formula</div>$$$1$$</div>'
        );

      // 7) Inline math: $...$ → \(...\)
      html = html.replace(/\$(.+?)\$/g, (_, expr) => `\\(${expr}\\)`);

      // Finally, restore the escaped dollar signs
      html = html.replace(/ESCAPED_DOLLAR_SIGN/g, '$');

      // 8) Return—but first let MathJax render it into #markdown-output
      if (window.MathJax) {
        MathJax.typesetPromise([html]).then(() => {
          document.getElementById('markdown-output').innerHTML = html;
        });
      }
      return html;
    }


    function renderTable(tableMd) {
      const lines = tableMd.trim().split('\n');
      const headers = lines[0].split('|').slice(1, -1).map(h => h.trim());
      const rows = lines.slice(2).map(r =>
        r.split('|').slice(1, -1).map(c => c.trim())
      );

      let tableHtml = '<table><thead><tr>';
      headers.forEach(h => tableHtml += `<th>${h}</th>`);
      tableHtml += '</tr></thead><tbody>';
      rows.forEach(cells => {
        tableHtml += '<tr>';
        cells.forEach(c => tableHtml += `<td>${c}</td>`);
        tableHtml += '</tr>';
      });
      tableHtml += '</tbody></table>';

      // Wrap the table in a scroll‐hint container
      return `<div class="table-wrapper">${tableHtml}</div>`;
    }


    window.addEventListener('hashchange', handleHashRoute);
    window.addEventListener('DOMContentLoaded', handleHashRoute);
    window.addEventListener('DOMContentLoaded', renderMainPage);

    // Initialize the blog page on load
    window.addEventListener('DOMContentLoaded', () => {
      // Hide all pages initially
      document.querySelectorAll('.page-content').forEach(page => {
        page.style.display = 'none';
      });
      // Show blog page by default
      document.getElementById('blog-page').style.display = 'block';
    });

    function handleHashRoute() {
      const slug = window.location.hash.replace(/^#\/?/, '');
      if (slug) {
        loadPost(slug);
      } else {
        goBack();
      }
    }

    function loadPost(slug) {
      // Check both posts and projects
      let post = posts.find(p => p.slug === slug);
      let isProject = false;

      if (!post) {
        post = projects.find(p => p.slug === slug);
        isProject = true;
      }

      if (!post) return;

      currentIndex = isProject ? projects.indexOf(post) : posts.indexOf(post);

      fetch(post.file)
        .then(r => r.text())
        .then(md => {
          document.getElementById('main-nav').style.display = 'none';
          document.querySelector('.page-content.active').style.display = 'none';
          document.getElementById('main-title').style.display = 'none';
          document.getElementById('post-content').style.display = 'block';
          document.getElementById('markdown-output').innerHTML = parseMarkdown(md);
          document.getElementById('article-chapter').innerText = Array.isArray(post.tags) ? post.tags.join(' • ') : post.tags;
          document.getElementById('article-title').innerText = post.title;
          document.getElementById('article-date').innerText = (post.date || '');
          window.scrollTo(0, 0);

          // Typeset MathJax after content is loaded
          if (window.MathJax) {
            MathJax.typesetPromise();
          }
        });
    }

    window.onpopstate = (e) => {
      if (e.state?.slug) loadPost(e.state.slug);
      else goBack();
    };

    window.addEventListener('DOMContentLoaded', () => {
      const slug = window.location.pathname.slice(1);
      if (slug) loadPost(slug);
    });
  </script>
</body>

<footer id="main-footer">
  <p>Copyright 2025 — Contact: <a href="mailto:nader.business.mail@gmail.com">nader.business.mail@gmail.com</a></p>
</footer>

</html>